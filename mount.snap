#!/bin/bash
  SAMBA_FILE="/etc/samba/smb.conf"
  x=1
  for variable in $(zfs list -t snapshot | grep -v NAME | awk -F " " {'print $1'});do
    arrVar+=("$variable")
    x=$((x+1))
  done
  for snapsDir in ${arrVar[@]};do
    mkdir -p /snaps/$snapsDir
  done
  for snaps in ${arrVar[@]};do
    mount -t zfs $snaps /snaps/$snaps
  done
  echo "[global]" > $SAMBA_FILE
  echo "workgroup = WORKGROUP" >> $SAMBA_FILE
  echo "security = user" >> $SAMBA_FILE
  echo "passdb backend = tdbsam" >> $SAMBA_FILE
  echo "printing = cups" >> $SAMBA_FILE
  echo "printcap name = cups" >> $SAMBA_FILE
  echo "load printers = no" >> $SAMBA_FILE
  echo "cups options = raw" >> $SAMBA_FILE
  for samba in ${arrVar[@]};do
    name=$(echo $samba | sed "s/://g")
    echo "[$name]" >> $SAMBA_FILE
    echo "path = /snaps/$samba" >> $SAMBA_FILE
    echo "valid users = cent     # allow only security group" >> $SAMBA_FILE
    echo "writable = no" >> $SAMBA_FILE
    echo "public = yes" >> $SAMBA_FILE
    echo "browseable = yes" >> $SAMBA_FILE
    echo "# ZFS Snap --- ${arrVar[$snap1]}]" >> $SAMBA_FILE  # name of snap
  done
  systemctl restart smb nmb
